<!-- Invoice List Table -->
<div class="card">
    <div class="card-datatable table-responsive">
        <table class="invoice-list-table table border-top">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Prenom</th>
                    <th>Email</th>
                    <th>Numero</th>
                    <th>Adresse</th>
                    <th>Genre</th>
                    <th>ROLE</th>
                    <th class="cell-fit" style="width: 120px">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if clients is defined %}
                    {% for client in clients %}
                        <tr>
                            <td>{{ client.getNomC() }}</td>
                            <td>{{ client.getPrenomC() }}</td>
                            <td>{{ client.getEmailC() }}</td>
                            <td>{{ client.getNumeroC() }}</td>
                            <td>{{ client.getAdresseC() }}</td>
                            <td>{{ client.getGenre().value }}</td>
                            <td>{{ client.getRole().value }}</td>
                            <td>
                                <div style="width: 92px;">
                                    <form style="display: inline-block"
                                          action="{{ path('delete_client', {id: client.getIdClient() }) }}"
                                          method="post"
                                          data-confirmation="true">
                                        <input type="hidden" name="token" value="{{ csrf_token('delete') }}"/>
                                        <a href="{{ path('edit_client', {'id': client.getIdClient() }) }}"
                                           class="btn btn-icon rounded-pill waves-effect">
                                            <i class="tf-icons text-primary ti ti-pencil"></i>
                                        </a>
                                        <button type="button"
                                                class="btn btn-icon waves-effect rounded-pill confirm-text m-lg-1">
                                            <i class="tf-icons text-danger ti ti-trash"></i>
                                        </button>
                                    </form>
                                    <button type="button"
                                            class="btn btn-icon waves-effect rounded-pill confirm-text m-lg-1 ban-btn{% if client.isBanned %} btn-danger {% endif %}"
                                            data-client-id="{{ client.getIdClient() }}">
                                        <i class="tf-icons ti ti-ban"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const banButtons = document.querySelectorAll(".ban-btn");

        banButtons.forEach(button => {
            button.addEventListener("click", function() {
                const clientId = this.dataset.clientId;
                const isBanned = this.classList.contains("banned");
                const url = isBanned ? "/client/unban/" + clientId : "/client/ban/" + clientId;
                const method = "POST";

                fetch(url, {
                    method: method,
                    headers: {
                        "Content-Type": "application/json",
                        "X-Requested-With": "XMLHttpRequest",
                        "X-CSRF-Token": "{{ csrf_token('ban') }}"
                    }
                }).then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error("Network response was not ok.");
                }).then(data => {
                    if (data.success) {
                        button.classList.toggle("banned");
                        button.classList.toggle("btn-danger");
                    } else {
                        alert(data.message);
                    }
                }).catch(error => {
                    console.error("Error:", error);
                });
            });
        });
    });
</script>
